# lzctl import

Generate Terraform import blocks and HCL configuration for existing Azure resources.

## Synopsis

```bash
lzctl import [flags]
```

## Description

Enables progressive IaC adoption by generating:

- `import {}` blocks (native Terraform 1.5+ syntax)
- Matching HCL configuration — **AVM module stubs** when a verified module exists, raw `resource` blocks otherwise
- A migration plan organised by CAF layer

Supported AVM modules are auto-detected based on resource type:

| Azure resource type | AVM module |
|--------------------|-----------| 
| `azurerm_key_vault` | `Azure/avm-res-keyvault-vault/azurerm` |
| `azurerm_linux_web_app` / `azurerm_windows_web_app` | `Azure/avm-res-web-site/azurerm` |
| `azurerm_service_plan` | `Azure/avm-res-web-serverfarm/azurerm` |
| `azurerm_api_management` | `Azure/avm-res-apimanagement-service/azurerm` |
| `azurerm_kubernetes_cluster` | `Azure/avm-res-containerservice-managedcluster/azurerm` |
| `azurerm_container_registry` | `Azure/avm-res-containerregistry-registry/azurerm` |

## Flags

| Flag | Default | Description |
|------|---------|-------------|
| `--from` | | Path to an audit JSON report |
| `--subscription` | | Subscription ID for live discovery |
| `--resource-group` | | Resource group for live discovery |
| `--include` | | Resource types to include (comma-separated) |
| `--exclude` | | Resource types to exclude (comma-separated) |
| `--layer` | auto | Target layer for generated files |
| `--ci` | `false` | Non-interactive mode (global flag) |

In CI mode (`--ci` or `CI=true`), at least one of `--from`, `--subscription`, or
`--resource-group` is required.

### Blueprint layers

Use `landing-zones/<name>/blueprint` as the `--layer` value to import resources
directly into a blueprint layer:

```bash
lzctl import --from audit-report.json --layer landing-zones/app-prod/blueprint
```

lzctl validates that the path follows the `landing-zones/<name>/blueprint` pattern before writing any files.

## Examples

```bash
# Import from an audit report
lzctl import --from audit-report.json

# Import directly from a resource group
lzctl import --resource-group rg-core --layer connectivity

# Target a blueprint layer
lzctl import --from audit-report.json --layer landing-zones/app-prod/blueprint

# Dry-run (no files written)
lzctl import --subscription 00000000-... --dry-run

# CI headless — no interactive prompts
CI=true lzctl import --from audit-report.json --dry-run

# Filter by resource type
lzctl import --from audit-report.json --include Microsoft.Network/virtualNetworks
```

## Generated files

```
imports/
├── connectivity/
│   ├── import.tf        # import {} blocks
│   └── resources.tf     # HCL configuration (AVM stubs where available)
└── general/
    ├── import.tf
    └── resources.tf
```

### AVM stub example

```hcl
# Auto-generated by lzctl import
module "key_vault" {
  source  = "Azure/avm-res-keyvault-vault/azurerm"
  version = "~> 0.9"

  name                = "kv-app-prod-weu"
  resource_group_name = var.resource_group_name
  location            = var.location
  tenant_id           = var.tenant_id
}
```

### Layer routing

| Resource type | Auto-detected layer |
|--------------|-------------------|
| Virtual Networks, Firewalls, Route Tables | `connectivity` |
| Log Analytics, Automation Accounts | `management` |
| Management Groups, Policy Assignments | `governance` |
| App Services, APIM, Key Vaults | `blueprint-paas` |
| AKS, Container Registry, ACA | `blueprint-aks` |
| AVD session hosts, host pools | `blueprint-avd` |

## Workflow

```
lzctl audit --json --output audit-report.json
    → lzctl import --from audit-report.json --dry-run
    → lzctl import --from audit-report.json
    → terraform plan  (verify zero-diff)
    → git add → commit → push
```

## See also

- [audit](audit.md) — generate the input report
- [add-blueprint](add-blueprint.md) — attach a full secure blueprint
- [workload adopt](../cli-reference.md) — adopt a whole subscription
- [CI headless](../operations/ci-headless.md) — run import without wizard in pipelines
